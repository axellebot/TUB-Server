{% extends '::base_nav.html.twig' %}
{% block title %}Lines{% endblock %}
{% block pageContent %}
    <div class="mdl-grid">

        {% if lines | length==0 %}
            <div class="mdl-card mdl-cell mdl-cell--6-col-desktop mdl-cell--6-col-tablet mdl-cell--4-col-phone mdl-cell--3-offset-desktop mdl-cell--1-offset-tablet mdl-shadow--6dp">
                <div class="mdl-card__title mdl-color--primary mdl-color-text--white">
                    <h2 class="mdl-card__title-text">{{ block('title') }}</h2>
                    {% if is_granted('ROLE_ADMIN') %}
                        <div class="mdl-layout-spacer"></div>
                        <!-- FAB button with ripple -->
                        <a class="mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab mdl-js-ripple-effect mdl-button--colored"
                           href="{{ path('line_create') }}">
                            <i class="material-icons">add</i>
                        </a>
                    {% endif %}
                </div>
                <div class="mdl-card__supporting-text">
                    <h1>There is no Stops here !</h1>
                </div>
            </div>
        {% else %}
            {% for line in lines %}
                <div class="mdl-cell mdl-cell--2-col mdl-cell--4-col-tablet mdl-cell--2-col-phone mdl-card mdl-shadow--4dp card-line"
                     style="display:flex;justify-content:center;align-items:center;background-color: {{ line.color }};">
                    <div class="mdl-card__supporting-text"
                         onclick="openLineDetail({{ line.id }})">
                        <div class="line-text-container">{{ line.number }}</div>
                    </div>
                    {% if is_granted('ROLE_ADMIN') %}
                        <div class="mdl-card__menu">
                            <button id="drop-menu-{{ line.id }}"
                                    class="mdl-button mdl-js-button mdl-button--icon">
                                <i class="material-icons">more_vert</i>
                            </button>
                            <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect"
                                data-mdl-for="drop-menu-{{ line.id }}">
                                <a class="mdl-menu__item" href="{{ path('line_update',{'id':line.id}) }}">Edit</a>

                                <a class="mdl-menu__item"
                                   onclick="openDeleteConfirmationDialog({{ line.id }})">Delete</a>
                            </ul>
                        </div>
                    {% endif %}
                </div>
            {% endfor %}
            {% if is_granted('ROLE_ADMIN') %}
                <div class="mdl-cell mdl-cell--2-col mdl-cell--4-col-tablet mdl-cell--2-col-phone mdl-card mdl-shadow--4dp card-line"
                     style="display:flex;justify-content:center;align-items:center;background-color:#FFFFFF;"
                     onclick="createLine()">
                    <div class="mdl-card__supporting-text">
                        <div class="line-text-container ">+</div>
                    </div>
                </div>
                <dialog id="dialog-line-delete-confirmation" class="mdl-dialog">
                    <h4 class="mdl-dialog__title">Do you really want to delete this Line ?</h4>
                    <div class="mdl-dialog__actions">
                        <button type="button" class="mdl-button close" onclick="closeDeleteConfirmationDialog()">No
                        </button>
                        <button type="button" class="mdl-button" onclick="deleteLine()">Yes</button>
                    </div>
                </dialog>
            {% endif %}

            {% for line in lines %}
                <dialog id="dialog-line-{{ line.id }}"
                        class="mdl-dialog mdl-cell--8-col-desktop mdl-cell--7-col-tablet mdl-cell--3-col-phone mdl-cell--">
                    <h4 class="mdl-dialog__title">{{ line.label }}</h4>
                    <div class="mdl-dialog__content">

                        <h5>Outbound :</h5>
                        <p>
                            {% for stopGroup in line.stopGroups %}
                                {% if stopGroup.way =='O' %}
                                    <span class="mdl-chip">
                                    <span class="mdl-chip__text">{{ stopGroup.stop.label }}</span>
                                </span>
                                {% endif %}
                            {% endfor %}
                        </p>
                        <h5>Inbound :</h5>
                        <p>
                            {% for stopGroup in line.stopGroups %}
                                {% if stopGroup.way =='I' %}
                                    <span class="mdl-chip">
                                    <span class="mdl-chip__text">{{ stopGroup.stop.label }}</span>
                                </span>
                                {% endif %}
                            {% endfor %}
                        </p>
                    </div>
                    <div class="mdl-dialog__actions">
                        <button type="button" class="mdl-button close" onclick="closeLineDetail({{ line.id }})">Close
                        </button>
                    </div>
                </dialog>
            {% endfor %}
        {% endif %}
    </div>
{% endblock %}


    {% block stylesheets %}
        <style>
            .line-text-container {
                font-size: 12vh;
                color: black;
                text-align: center;
            }

            .mdl-card__supporting-text {
                line-height: normal;
                cursor: pointer;
            }

        </style>
    {% endblock %}

    {% block javascripts %}
        <script>
            function openLineDetail(lineId) {
                var dialog = document.querySelector('#dialog-line-' + lineId);
                dialog.showModal();
            }

            function closeLineDetail(lineId) {
                var dialog = document.querySelector('#dialog-line-' + lineId);
                dialog.close();
            }

            {% if is_granted('ROLE_ADMIN') %}
            var lineIdToDelete;
            function openDeleteConfirmationDialog(id) {
                var dialog = document.querySelector('#dialog-line-delete-confirmation');
                lineIdToDelete = id;
                dialog.showModal();
            }
            function closeDeleteConfirmationDialog() {
                var dialog = document.querySelector('#dialog-line-delete-confirmation');
                dialog.close();
            }
            function deleteLine() {
                window.location.href = "/admin/line/delete/" + lineIdToDelete;
            }
            function createLine() {
                window.location.href = "{{ path('line_create') }}";
            }
            {% endif %}
        </script>
    {% endblock %}